# 序言[^1]

在项目或者课题中经常会用到编程技能，用于解决一些特定的问题或者帮助实现具体的想法。程序或软件的构建往往并不只是单人活动，程序也不是写完就可以不用回顾，做好代码的维护、管理、与他人协作等和写代码本身一样重要。高可读性、易维护性、低出错率、方便与他人的合作等是好代码的必备条件。但是由于每个人学习的路线不尽相同，同时每个人在初期都形成了自己的一套习惯，这给代码的后期维护和管理，组内成员的交流、构建可重复使用的程序等造成了一定的困难。因此，为解决上述问题，有必要根据软件开发实践方面的资料[@mcconnellDaiMaDa2006]、组内的编程风格及相关的专业知识编写出一套约束规范。

从程序构建的角度来讲，一个整体架构上的平衡将使得复杂的程序更具秩序，复杂整体中的每个细节都能在这个统一的框架下发挥作用。统一的规则减少了因为不同部分采取了不同的编程风格而产生的混乱与割裂

编程约定可有以下几个方面：
- 变量规范
- 类规范
- 子程序规范
- 格式约定
- 注释约定

# 变量名的规范[^2]

变量是编程活动中非常常见的一个概念，但是变量的使用、命名等方面上存在许多有待规范和统一的细节

## 变量的作用域

### 尽可能缩小变量的作用域

作用域形容一个变量的可见的程度，体现了它在多大的范围内起作用，可以从跨度和存活时间两个指标去衡量

在用到变量的时候再去考虑初始化和赋值，这样在追溯变量的同时就比较容易找到它

相关语句放在一起可以提高变量引用的集中程度，比如一组语句都引用到了同一个变量，虽然它们的顺序无关紧要，但是考虑到缩小作用域的原则，尽可能将这组语句放在一起

相关的语句还可以提取成单独的子程序以进一步减小变量的作用域

尽量局部化，少用全局变量，有利于代码的管理

### 变量的初始化遵循就近原则

在变量声明的同时初始化

在靠近第一次使用变量的地方进行初始化

### 尽可能缩短变量的跨度和存活时间

跨度形容的是引用变量的集中程度，在一段代码中一个变量频繁出现，这表明变量的跨度比较小，将变量的引用点，也就是用到变量的地方尽可能集中在一起，这样做可以提升可读性，让阅读者可以不用来回地翻看很长的程序，同时通过减小变量引用点之间的空隙也能降低出错的可能性

存活时间丈量的是代码的第一次引用到最后一次引用跨过的代码篇幅或语句数量，缩短存活时间带来的好处和减小跨度类似，可以提升可读性，减少出错，也有利于后续划分新的独立子程序

### 变量被赋具体值的时间点越晚越好

将变量和值绑定在一起的时间点越晚，程序的灵活性就越高，一旦这里的值有变化，就不用在程序中多处修改类似的地方，而只需要修改数据的来源即可，但过度的灵活性会使程序更加复杂

使用具名常量而不是某个数值

### 为变量指定单一的用途

在一个程序中不要让同一个变量同时负责多个功能，这样可能会使没有关联的两段程序看似产生了“关联”，降低了可读性，尝试通过让变量的名称含义更加具体，更加接近要描述的事物

避免让变量有隐含的含义，例如用-1表示错误，这是用整型数据去代表布尔型数据，多出的这一类信息用另一个变量去表示，

同时，反过来，也要注意尽可能使用到所有已声明的变量，不要声明了但不使用

## 变量的命名

### 好的变量名要完全且准确地描述出该变量代表的事物

避免x、y、current这种表述不清变量具体代表的是什么的名称，这样做不利于读懂变量的含义

表达出是什么，而不是要干什么

如果一段代码需要让人去猜测含义的时候，有可能就是变量的命名出了问题

### 为不同类型的变量命名仍遵循表达出事物本身含义的原则

总体上仍遵循好的变量名要完全且准确地描述出该变量代表的事物这一原则

循环变量一旦在循环外使用到，就不要命名成i、j、k等

状态变量最好表示出什么的状态，而不是只用“状态”（flag）这种，同样状态后边对应的具体值也可以用具名常量或者枚举以表达出更清晰的含义

临时变量要尽可能弄懂它的具体含义，不要用一个“临时”含糊过去

布尔变量：使用典型的诸如done、error、found、success、ok等这种本身就包含是否含义的名字，也不要加否定词

### 命名规则对不同类型的数据或程序给出区分

- 变量名和子程序名作出区分
- 区分类和对象
- 区分出全局变量
- 区分出成员变量
- 区分出类型声明
- 区分出具名常量
- 区分出枚举
- 格式化：分隔符或大小写

### 变量命名的最佳长度在9～15个字符

不是很强硬的规定，但是当有很多变量名都不太符合这个长度时，就需要重新检查一下这些变量的名称是不是表示出了清晰的含义，或者过长导致不易读

### 变量的长度和作用域呈正相关

比较长的名字适合那些用的很少的变量或者全局变量，而那些很短的名字所代表的变量的作用域很小，例如循环变量i

全局变量前边可以加上限定词，或者通过其他方式划分它们的使用范围，减少命名冲突

### 变量名中的计算值限定词放在后边

把最大、最小、总和、平均这些词统一放在变量名字的后边，将有含义、比较重要的部分放在前边

### 编程命名时遵守对仗词的规则

使用约定好的、易理解的、保持一致的一组相反词：如open/close min/max old/new等

### 变量名包含的三类信息

变量的内容：表示什么

数据的类型：具名常量，简单变量等

变量的作用域：全局、类内部等

# 子程序的规范

子程序是一个大型程序中的某部分代码，由一个或多个语句块组成。它负责完成某项特定任务，而且相较于其他代码，具备相对的独立性[@ZiChengXu2024]。构建良好的子程序有助于大型代码的维护和管理。

## 子程序的命名

### 子程序的命名要清晰表达做了什么

描述出子程序做的所有事情，而不要只谈其一避开其二

避免笼统、模糊的表达，含义要具体、准确、尽量没有歧义

不使用数字，数字表达不出子程序的作用

### 对于不同类型的子程序，其特点和作用也要在命名上有所体现

- 函数的命名要对返回值有所描述
- 过程则是强调动词和宾语（面向对象语言中无需加宾语，因为已经在对象的调用语句中体现，再加宾语会重复）

### 子程序命名困难或参数太多可能是因为子程序本身设计有问题

如果包含的操作太多，或者本身所做的事情就模糊不清，就难以做到在完整清晰地描述子程序的作用的前提下控制住名字的长度，这是子程序本身设计的问题，应该着手程序的重新设计和组织，而不是牺牲子程序名字良好的描述性来应付这个问题

需要传递太多的参数也可能是因为子程序之间的耦合太强，应考虑重新设计或组织

### 对于过长（超过200行）的子程序保持谨慎

超过200行的子程序容易出错，成本偏高，可读性也不强

关注点放在影响子程序长短的那些因素上，如内聚性、嵌套层次、变量的数量、注释数量等，而不要刻意限制子程序的长度

### 子程序命名的合适长度与变量的命名长度类似

变量命名的最佳长度在9～15个字符

子程序比一个变量要复杂，因此相应项命名长度可能也会长一点

子程序命名的长度应以清晰表达为前提

## 参数或接口的规范

### 子程序的参数要考虑既定的顺序

按照输入-修改-输出的顺序排列参数，这样和子程序内部所包含的操作能有所对应

多个子程序使用类似的参数，则让它们的顺序保持一致，有利于记忆

状态或出错变量（不是程序的主要功能）放在最后边

### 子程序参数的数量限制在约7个以内

太多的参数记忆和理解比较困难

对于一些支持复杂数据类型的语言来说，上限也许可以再高一点，因为可以将比较多的成员合成一个大数据块

### 考虑根据不同的地位给子程序参数加前缀

如果认为输入、修改、输出参数的区分比较重要，可以考虑在它们的命名中加入相应的前缀，当然前提是遵循统一的命名规则

### 在接口中对参数的前提或某些约束加以说明

如果参数有某些特征，例如

- 输入/修改/输出
- 参数的单位
- 状态代码或错误值的含义（0、1代表什么？）
- 所能接受的数值范围
- 某些不合理的特定数值

对这些假定要予以说明

### 输入参数不能作为子程序中使用的工作变量

传入子程序的参数是不能在子程序中随意修改的，这样做会导致实际代表的含义和最初的变量名称不相匹配，会导致不必要的麻烦

做法：引入一个局部变量，代替其完成相关操作

### 实际参数和形式参数相匹配

名称上，形式参数和实际参数相互呼应，在名字上就能看出它们是相互对应的

类型上，形式参数和实际参数保持一致，整型对整形、浮点对浮点


[^1]:这一段写的没毛病。但是通用性较强，放之四海而皆准。我们首先要清楚编写这个规范的目的，我们是要编写一套我们课题组自己用的标准，可以借鉴书籍或者大厂经验。其次，根据自身需求编写资料，建议参考以下两点：1.通俗简单易上手；2.符合我们课题组的研究方向。可以先了解我们课题组的方向，以及需求。例如我们专注于模型开发，底层逻辑，那么一切前端代码的规范则无需过度聚焦。          
[^2]: 可以看出下了不少功夫，但是需要注意以下几点：1.不够通俗。代码知识我们的一个工具，我们聚焦于工艺模型的开发，因此部分内容难以直接理解，需要有相当的编程基础；2.不够具体。内容过于宽泛，大家的理解程度和编写习惯是有差距的，目前的规范方法更像是一个框架，我们可以在框架里尽情发挥，而不是类似说明书。Step1、Step2、Step3……；3.建议给出具体案例或者结合案例说明。